#include <string>
#include <iostream>
#include "CodeGen_Bash.h"
#include "Parser.h"

const std::string BISH_VERSION = "0.1";
const std::string BISH_URL = "BISH-URL";

void compile_to_bash(std::ostream &os, Bish::Module *m) {
    os << "#!/bin/bash\n";
    os << "# Autogenerated script, compiled from the Bish language.\n";
    os << "# Bish version " << BISH_VERSION << "\n";
    os << "# Please see " << BISH_URL << " for more information about Bish.\n\n";
    Bish::CodeGen_Bash compile(os);
    m->accept(&compile);
}

int main(int argc, char **argv) {
    if (argc < 2) {
        std::cerr << "USAGE: " << argv[0] << " <INPUT>\n";
        std::cerr << "  Compiles Bish file <INPUT> to bash.\n";
        return 1;
    }
    
    std::string path(argv[1]);
    Bish::Parser p;
    Bish::Module *m = p.parse(path);

    compile_to_bash(std::cout, m);
    
    return 0;
}
